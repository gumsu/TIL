# 운영체제
## 프로세스와 스레드의 차이는 무엇일까?
### Process, Thread, multitasking, multi-processing, multi-threading
- `Process` 는 컴퓨터에서 실행중인 프로그램이며, 각각의 프로세스는 독립된 메모리 공간을 할당 받아 명령어들과 데이터를 가진다. 
- `Thread` 는 프로세스 내에 실행되는 흐름의 단위이다.
- `multitasking` 는 여러 프로세스를 운영체제 스케줄링에 의해 번갈아 수행되도록 하는 것이다.
  - CPU에 아주 작은 단위로 프로세스를 할당하며, 응답 시간 최소화가 목적이다.
  - **프로세스끼리 CPU를 경쟁**하며, 컨텍스트 스위칭 비용이 발생한다.
- `multi-processing` 는 두 개 이상의 프로세서나 코어를 활용하는 시스템을 말한다.
- `multi-threading` 는 하나의 프로세스가 여러 쓰레드로 동시에 여러 작업을 수행하는 것을 말한다.


### 프로세스와 스레드의 차이
- 프로세스
  - 운영체제로부터 자원을 할당받는다.
  - 프로세스는 독립된 공간의 메모리 영역(stack, heap, data, code) 을 받는다.
- 스레드
  - 프로세스가 할당받은 자원을 이용하는 실행의 단위이다.
  - 스레드는 stack을 제외한 code, data, heap 영역을 공유한다.

### 멀티 프로세스와 멀티 스레드의 차이
- 멀티 프로세스
  - 독립된 메모리 공간으로 다른 프로세스에 영향이 없다.
  - 다른 프로세스와의 자원 공유를 위해 IPC 구현이 필요하다.
- 멀티 스레드
  - 스레드끼리 메모리를 공유한다. 자원을 효율적으로 관리할 수 있다.
  - 프로세스보다 `context switching` 이 빠르다.
  - 하나의 스레드가 비정상 동작할 경우 다른 쓰레드에도 문제가 생길 수 있다.
  
### 멀티 프로세스보다 멀티 스레드가 좋은 점
- 프로세스를 생성하고 자원을 할당하는 등의 system call을 줄일 수 있어 자원을 효율적으로 관리할 수 있다.
- 프로세스 간 통신(IPC) 보다 스레드 간 통신의 비용이 더 적다.
- context switching 시 캐시 메모리를 초기화할 필요가 없어 속도가 빠르다.

### 그렇다면 무조건 멀티 스레드가 좋을까?
- 스레드 간의 자원 공유 시 동기화 문제가 발생할 수 있다.

## 컨텍스트 스위칭이란?
- 진행 중인 task 상태를 저장하고 다음에 진행할 task의 상태 값을 읽어오는 과정이다.
  
### 컨텍스트 스위칭이 왜 필요할까?
- CPU는 한 번에 하나의 프로세스만 실행 가능하다. task가 끝날때까지 다음 task는 기다려야한다. 그래서 CPU는 task를 일정 시간마다 바꿔가며 실행한다.
- 이때 실행하다 멈춘 상태를 저장하고, 다음 프로세스의 상태 값을 가져오는 작업이 필요하다.
- 프로세스의 흐름을 이어간다 = 문맥을 이어간다 = context switching

### 컨텍스트 스위칭의 흐름
1. CPU가 A프로세스를 실행하다 B프로세스로 변경하고자 한다.
2. A프로세스는 커널모드에 제어권을 넘긴다.
3. 커널모드에서 A프로세스의 상태를 저장하고 B프로세스의 상태를 로딩한다.
4. 캐시 flush, TLB를 비우고, MMU를 B프로세스를 바라보도록 변경한다.
   - **스레드는 이 과정이 없다.**
5. 커널모드에서 다시 B프로세스로 전환되어 실행한다.

### process context switching 과 thread context switching
- 공통점
  - 커널모드에서 실행된다.
    - 컨텍스트 스위칭은 OS 커널에 의해 수행된다.
  - CPU의 레지스터 상태를 교체한다.
    - 이전에 실행되고 있는 정보를 저장하는 작업을 수행한다.
- 차이점
  - 프로세스 컨텍스트 스위칭은 가상 메모리 주소 관련 처리 (MMU, TLB)를 추가로 수행해야 한다.

### 컨텍스트 스위칭의 비용
- 컨텍스트 스위칭은 많은 비용이 소모된다.
  - cache 초기화
  - memory mapping 초기화
  - kernel은 항상 실행
- 캐시 오염
  - 서로 다른 프로세스로 변경되기 때문에 CPU에 있던 캐시가 쓸모 없어진다.

